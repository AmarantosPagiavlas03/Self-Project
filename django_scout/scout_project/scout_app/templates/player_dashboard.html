<!DOCTYPE html>
<html>
<head>
    <title>Player Dashboard</title>
    {% load static %}
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="{% static 'styles.css' %}">
</head>
<body>
    {% include 'navbar.html' %}
    <div class="dashboard_card__container">
 
            <div class="dashboard_card_container__wrapper"> 
                <!-- Profile Card -->
                <div class="dashboard_card_container__row">
                    <div class="dashboard_card_container__column">
                        <div class="dashboard_card__card dashboard_card__main_card">
                            <div class="card-body text-center p-4">
                                <h2>Player Profile</h2>
                                <p>Welcome Player, {{ profile.first_name }} {{ profile.last_name }}</p>
                                {% if profile.user == request.user %}
                                    <a href="{% url 'edit_profile' %}" class="btn btn-primary">Edit Profile</a>
                                {% endif %}
                                <a href="{% url 'view_profile' %}" class="btn btn-primary">View Full Profile</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="dashboard_card_container__row">
                    <!-- Performance Card -->
                    <div class="dashboard_card_container__column">
                        <div class="dashboard_card__card">
                            <div class="dashboard_card__card_content">
                                <h5 class="card_dashboard__title">Performance</h5>
                                <p>Check your stats and progress</p>
                                <a href="{% url 'statistics' %}" class="btn btn-primary">View Stats</a>
                            </div>
                        </div>
                    </div>

                    <!-- Match History Card -->
                    <div class="dashboard_card_container__column">
                        <div class="dashboard_card__card">
                            <div class="dashboard_card__card_content">
                                <h5 class="card_dashboard__title">Recent Matches</h5>
                                <p>Review your last matches</p>
                                <a href="#" class="btn btn-primary">View History</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Upcoming Events and News Cards -->
                <div class="dashboard_card_container__row"> 
                    <!-- Training Card -->
                    <div class="dashboard_card_container__column">
                        <div class="dashboard_card__card">
                            <div class="dashboard_card__card_content">
                                <h5 class="card_dashboard__title">Upcoming Events</h5>
                                <p>Trainings and fixtures</p>
                                <a href="#" class="btn btn-primary">View Schedule</a>
                            </div>
                        </div>
                    </div>

                    <!-- News Card -->
                    <div class="dashboard_card_container__column">
                        <div class="dashboard_card__card">
                            <div class="dashboard_card__card_content">
                                <h5 class="card_dashboard__title">Latest News</h5>
                                <p>Stay updated with team news</p>
                                <a href="#" class="btn btn-primary">Read More</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Performance Overview and Statistics Barplot Cards -->
                <div class="dashboard_card_container__row"> 
                    <div class="dashboard_card_container__column">
                        <div class="dashboard_card__card">
                            <div class="dashboard_card__card__chart_container"> 
                                <h5 class="card_dashboard__title">
                                    Performance Overview
                                    <span class="info-icon-container">
                                        <svg class="info-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12 16V12M12 8H12.01M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        <span class="info-tooltip">Shows your overall performance metrics across different aspects of the game</span>
                                    </span>
                                </h5>
                                <canvas id="performanceChart" width="300" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="dashboard_card_container__row"> 
                    <div class="dashboard_card_container__column">
                        <div class="dashboard_card__card">
                            <div class="dashboard_card__card__chart_container"> 
                                <h5 class="card_dashboard__title">
                                    Statistics Barplot
                                    <span class="info-icon-container">
                                        <svg class="info-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M12 16V12M12 8H12.01M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                        </svg>
                                        <span class="info-tooltip">Displays your key statistics in a bar chart format</span>
                                    </span>
                                </h5>
                                <a href="{% url 'scout_app:detailed_statistics' %}" class="statistics-link">
                                    <div class="chart-wrapper">
                                        <canvas id="performanceBarPlot"></canvas>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
 
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Radar Chart - Performance Overview
            const labels = JSON.parse('{{ performance_data.labels|escapejs }}');
            const data = JSON.parse('{{ performance_data.data|escapejs }}');
            const total = data.reduce((acc, val) => acc + val, 0);
            const chartCard = document.getElementById('performanceChart')
                              .closest('.dashboard_card_container__row');
            if (data.length === 0|| total === 0) {
                chartCard.style.display = 'none';
            } else {
                const ctx = document.getElementById('performanceChart').getContext('2d');
                new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Performance Metrics',
                            data: data,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            pointBackgroundColor: 'rgb(75, 192, 192)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgb(75, 192, 192)'
                        }]
                    },
                    options: {
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            r: {
                                min: 0,
                                max: 4,
                                ticks: {
                                    stepSize: 1,
                                    backdropColor: "transparent"
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Bar Chart - Performance Statistics
            const bar_plot_labels = JSON.parse('{{ bar_plot_data.labels|escapejs }}');
            const bar_plot_data = JSON.parse('{{ bar_plot_data.data|escapejs }}');
            const total = bar_plot_data.reduce((acc, val) => acc + val, 0);
            const chartCard = document.getElementById('performanceBarPlot')
                              .closest('.dashboard_card_container__row');
            if (bar_plot_data.length === 0|| total === 0) {
                chartCard.style.display = 'none';
            }  else {
                const barCtx = document.getElementById('performanceBarPlot').getContext('2d');
                new Chart(barCtx, {
                    type: 'bar',
                    data: {
                        labels: bar_plot_labels,
                        datasets: [{
                            label: 'Performance Stats',
                            data: bar_plot_data,
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgb(54, 162, 235)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                min: 0,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>